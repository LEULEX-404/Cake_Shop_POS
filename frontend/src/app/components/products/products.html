<div class="billing-wrapper">
  <!-- Header Section -->
  <header class="billing-header">
    <div class="header-left">
      <h1 class="company-name">Cake Shop</h1>
      <p class="tagline">Sale System</p>
    </div>
    <div class="header-right">
      <div class="datetime-display">
        <span class="current-date" id="currentDate">{{ currentDate }}</span>
        <span class="current-time" id="currentTime">{{ currentTime }}</span>
      </div>
      <div class="user-greeting">
        <span class="greeting-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
            <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
          </svg>          
        </span>
        <span class="greeting-text">Hello, Cashier</span>
        <a href="/admin/products" class="admin-link">Admin Panel</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="billing-content">
    <!-- Left Panel - Product Search -->
    <div class="left-panel">
      <div class="card search-card">
        <h2 class="card-title">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
              <path d="M8.25 10.875a2.625 2.625 0 1 1 5.25 0 2.625 2.625 0 0 1-5.25 0Z" />
              <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.125 4.5a4.125 4.125 0 1 0 2.338 7.524l2.007 2.006a.75.75 0 1 0 1.06-1.06l-2.006-2.007a4.125 4.125 0 0 0-3.399-6.463Z" clip-rule="evenodd" />
            </svg>
            
          </span>
          Product Lookup
        </h2>

        <div class="form-group">
          <label for="barcode" class="form-label">Barcode / SKU</label>
          <div class="input-with-button">
            <input
              id="barcode"
              type="text"
              [(ngModel)]="barcode"
              placeholder="Scan or enter barcode"
              (keydown.enter)="onBarcodeEnter()"
              (keydown.tab)="onBarcodeTab($any($event))"
              autofocus
              class="form-input barcode-input"
            />
            <button (click)="searchProduct()" class="btn btn-primary">
              <span class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                  <path d="M8.25 10.875a2.625 2.625 0 1 1 5.25 0 2.625 2.625 0 0 1-5.25 0Z" />
                  <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm-1.125 4.5a4.125 4.125 0 1 0 2.338 7.524l2.007 2.006a.75.75 0 1 0 1.06-1.06l-2.006-2.007a4.125 4.125 0 0 0-3.399-6.463Z" clip-rule="evenodd" />
                </svg>
                
              </span>
              Search
            </button>
          </div>
        </div>

        <div *ngIf="product" class="product-details">
          <div class="product-header">
            <h3 class="product-name">{{ product.name }}</h3>
            <span class="product-badge">{{ product.type }}</span>
          </div>

          <div class="product-info">
            <div class="info-item">
              <span class="info-label">Stock Available:</span>
              <span class="info-value stock-qty">{{ product.stockQty }} units</span>
            </div>
            <div class="info-item">
              <span class="info-label">Unit Price:</span>
              <span class="info-value price">{{ (product.type === 'fixed' ? product.price : product.pricePerKg) }} LKR</span>
            </div>
          </div>

          <div class="form-group">
            <label for="qty" class="form-label">Quantity</label>
            <div class="quantity-controls">
              <input
                id="qty"
                type="number"
                [(ngModel)]="qty"
                min="1"
                (keydown.enter)="onQtyEnter()"
                class="form-input qty-input"
              />
              <button (click)="addToInvoice()" class="btn btn-success">
                <span class="btn-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 9a.75.75 0 0 0-1.5 0v2.25H9a.75.75 0 0 0 0 1.5h2.25V15a.75.75 0 0 0 1.5 0v-2.25H15a.75.75 0 0 0 0-1.5h-2.25V9Z" clip-rule="evenodd" />
                  </svg>
                  
                </span>
                Add to Invoice
              </button>
            </div>
          </div>
        </div>

        <p class="message" [class.error]="messageType === 'error'" [class.success]="messageType === 'success'">
          {{ message }}
        </p>
      </div>

      <!-- Quick Stats -->
      <div class="card stats-card">
        <h3 class="card-title">
          <div class="summary-icon">
          <span class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
              <path d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75ZM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 0 1-1.875-1.875V8.625ZM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 0 1 3 19.875v-6.75Z" />
            </svg>
          </span>
          </div>
          Session Summary
        </h3>
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value">{{ invoiceItems.length }}</span>
            <span class="stat-label">Items</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ calculateTotalQty() }}</span>
            <span class="stat-label">Qty</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ invoiceTotal }}</span>
            <span class="stat-label">LKR</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel - Invoice -->
    <div class="right-panel">
      <div class="card invoice-card">
        <div class="invoice-header">
          <h2 class="card-title">
            <span class="icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                <path fill-rule="evenodd" d="M7.502 6h7.128A3.375 3.375 0 0 1 18 9.375v9.375a3 3 0 0 0 3-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 0 0-.673-.05A3 3 0 0 0 15 1.5h-1.5a3 3 0 0 0-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6ZM13.5 3A1.5 1.5 0 0 0 12 4.5h4.5A1.5 1.5 0 0 0 15 3h-1.5Z" clip-rule="evenodd" />
                <path fill-rule="evenodd" d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 0 1 3 20.625V9.375ZM6 12a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V12Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 15a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V15Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h.008a.75.75 0 0 1 .75.75v.008a.75.75 0 0 1-.75.75H6.75a.75.75 0 0 1-.75-.75V18Zm2.25 0a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H9a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd" />
              </svg>
              
            </span>
            Current Invoice
          </h2>
          <span class="invoice-number">INV-{{ invoiceNumber }}</span>
        </div>

        <div *ngIf="invoiceItems.length === 0" class="empty-invoice">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
              <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
            </svg>
            
          </div>
          <p>No items added yet</p>
          <small>Scan or search for products to begin</small>
        </div>

        <div *ngIf="invoiceItems.length > 0" class="invoice-content">
          <div class="table-wrapper">
            <table class="invoice-table">
              <thead>
                <tr>
                  <th>Item</th>
                  <th class="text-center">Qty</th>
                  <th class="text-right">Price</th>
                  <th class="text-right">Amount</th>
                  <th class="text-center">Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of invoiceItems; let i = index"
                    [attr.data-index]="i"
                    (keydown)="onInvoiceRowKey($event, i)"
                    tabindex="0">
                  <td class="item-name">{{ item.name }}</td>
                  <td class="text-center">{{ item.qty }}</td>
                  <td class="text-right">{{ item.price }}</td>
                  <td class="text-right amount">{{ item.amount }}</td>
                  <td class="text-center">
                    <button (click)="removeItem(i)" class="btn-remove" title="Remove item">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                        <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm3 10.5a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5h6Z" clip-rule="evenodd" />
                      </svg>
                      
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="invoice-summary">
            <div class="summary-row">
              <span>Subtotal:</span>
              <span class="summary-value">{{ invoiceTotal }} LKR</span>
            </div>
            <div class="summary-row">
              <span>Tax (0%):</span>
              <span class="summary-value">0.00 LKR</span>
            </div>
            <div class="summary-row total-row">
              <span>Total Amount:</span>
              <span class="total-value">{{ invoiceTotal }} LKR</span>
            </div>
          </div>

          <div class="action-buttons">
            <button (click)="openPaymentModal()" class="btn btn-large btn-primary">
              <span class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                  <path d="M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z" />
                  <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 3.75a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd" />
                </svg>
                
              </span>
              Complete Sale
            </button>
            <button (click)="clearInvoice()" class="btn btn-large btn-secondary">
              <span class="btn-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
                  <path fill-rule="evenodd" d="M16.5 4.478v.227a48.816 48.816 0 0 1 3.878.512.75.75 0 1 1-.256 1.478l-.209-.035-1.005 13.07a3 3 0 0 1-2.991 2.77H8.084a3 3 0 0 1-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 0 1-.256-1.478A48.567 48.567 0 0 1 7.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 0 1 3.369 0c1.603.051 2.815 1.387 2.815 2.951Zm-6.136-1.452a51.196 51.196 0 0 1 3.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 0 0-6 0v-.113c0-.794.609-1.428 1.364-1.452Zm-.355 5.945a.75.75 0 1 0-1.5.058l.347 9a.75.75 0 1 0 1.499-.058l-.346-9Zm5.48.058a.75.75 0 1 0-1.498-.058l-.347 9a.75.75 0 0 0 1.5.058l.345-9Z" clip-rule="evenodd" />
                </svg>                
              </span>
              Clear All
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Payment Modal -->
  <div class="modal-backdrop" *ngIf="showPaymentModal">
    <div class="payment-modal" role="dialog" aria-modal="true">
      <h3>Payment</h3>
      <div class="modal-row">
        <label>Total:</label>
        <div class="value">{{ invoiceTotal }} LKR</div>
      </div>

      <div class="modal-row">
        <label for="paymentType">Payment Type</label>
        <select #paymentTypeRef id="paymentType" [(ngModel)]="paymentType" 
        (keydown.enter)="focusPaidAmount()">
          <option value="cash">Cash</option>
          <option value="card">Card</option>
          <option value="mixed">Mixed</option>
        </select>
      </div>

      <div class="modal-row">
        <label for="paidAmount">Amount Paid</label>
        <input #paidAmountRef id="paidAmount" type="number" class="form-input"
       [(ngModel)]="paidAmount"
       (keydown.enter)="focusConfirmButton()" />
      </div>

      <div class="modal-row" *ngIf="paidAmount !== null">
        <label>Change</label>
        <div class="value">{{ computeChange() }} LKR</div>
      </div>

      <p class="modal-message" [class.error]="paymentError" *ngIf="paymentError">{{ paymentError }}</p>

      <div class="modal-actions">
        <button #confirmBtnRef (click)="confirmPayment()" class="btn btn-primary">
          Confirm & Print
        </button>
        <button (click)="closePaymentModal()" class="btn btn-secondary" [disabled]="isProcessing">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>
